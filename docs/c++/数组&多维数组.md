---
title: 数组&多维数组
date: 2022-05-01
tags:
 - C++
categories:
 - C++
---


### 数组

复合类型（声明形如：`a[d]`）

* a：数组名称
* d：元素个数（必须是常量表达式）

```cpp
unsigned cnt = 22;
constexpr unsigned sz = 22; // 常量表达式
int arr[10];
int *parr[sz];
string bad[cnt];			// 错误：cnt不是常量表达式
string strs[get_size()];	// 当get_size是constexpr是正确；否则错误
```

* 不存在引用数组
* 可以使用列表初始化，但必须指定数组类型，不允许使用auto

```cpp
const unsigned sz = 3;
int ial[sz] = {0, 1, 2};
int a2 = {0, 1, 2};
int a3[5] = {0, 1, 2};	// 等价于int a3[] = {0, 1, 2, 0, 0}
string a4[3] = {"hello", "world"};	// 等价于string a4[]={"hello", "world", ""};
int a5[2] = {0, 1, 2};
```

* 字符数组的特殊性：字符串字面值的结尾处还有一个空字符

```cpp
char a1[] = {'C', '+', '+'};	// 列表初始化，没有空字符
char a2[] = {'C', '+', '+', '\0'};	// 列表初始化，含有显示的空字符
char a3[] = "C++";	// 含有空字符
const char a4[6] = "Kellen";	// 错误，没有空间存放空字符
```

* 不允许拷贝和赋值

```cpp
int a[] = {0, 1, 2};
int a2[] = a; // 初始化时拷贝错误
a2 = a; 	  // 赋值错误
```

* 理解复杂的数组声明

```cpp
int *ptr[10]; // ptrs是含有10个元素(整型指针)的数组
int &refs[10]; // 错误：不存在引用的数组
int (*Parray)[10] = &arr;		// Parray指向一个含有10个整数的数组
int (&arrRef)[10] = arr'; 		// arrRef引用一个含有10个整数的数组
int *（&array）[10] = ptrs; 	  // array是数组的引用，该数组包含10个指针
```

### 多维数组

* 严格来说C++没有多维数组

```cpp
int ia[3][4]; // 大小为3的数组，每个元素是含有4个整数的数组
int arr[10][20][30] = 0; // 将所有元素初始化为0
```

* 初始化

```cpp
// 允许使用花括号初始化多维数组
int ia[3][4] = {
    {0, 1, 2, 3},
    {4, 5, 6, 7},
    {8, 9, 10, 11}
}
```

* 下标引用

```cpp
// 用arr的首元素为ia最后一行的最后一个元素赋值
ia[2][3] = arr[0][0][0];
int(&row)[4] = ia2[1]; // 把row绑定到ia的第二个4元素数组上

constexpr size_t rowCnt = 3, colCnt = 4;
int ia[rowCnt][colCnt]; // 12个未初始化的元素
// 对于每一行
for(size_t i = 0; i != rowCnt; ++i){
    for(size_t j = 0; j != colCnt; ++j){
        ia[i][j] = i * colCnt + j; // 将位置索引作为值
    }
}

size_t cnt = 0;
for(auto& row : ia){
    for(auto& col: row){
        col = cnt;
        ++cnt;
    }
}

for(auto row : ia){		// 取出来的数组，会被编译器转换为指针
	for(auto col : row){	// 错误：int *row没有合适的begin函数
        ;
    }
}

for(auto& row : ia){	// row声明为引用，可以避免被自动转换为指针
    for(auto col : row){
        cout<<col<<endl;
    }
}
```

* 指针和多维数组

```cpp
int ia[3][4];
int(*p)[4] = ia;
p = &ia[2]; // p指向ia的尾元素

// 输出ia中每个元素的值，每个内层数组各占一行
// p指向含有4个整数的数组
for(auto p = ia; p != ia+3; ++p){
    // q指向4个整数数组的首元素，也就是说，q指向一个整数
    for(auto q = *p; q != *p + 4; ++q){
        cout<< *q << "";
    }
    cout<<endl;
}

for(auto p = std::begin(ia); p != std::end(ia); ++p){
    // q指向内层数组的首元素
    for(auto q = std::begin(*p); q != std::end(*p); ++q){
        cout<< *q << "";
    }
    cout<<endl;
}
```

* 类型别名简化多维数组的指针

```cpp
using int array = int[4]; // typedef int int_array[4]

for(int array *p = ia; p != ia + 3; ++p){
    for(int *q = *p; q != *p + 4; ++q){
        cout<< *q << "";
    }
    cout<<endl;
}
```





