---
title: 虚函数和纯虚函数
date: 2024-08-11
tags:
 - C++
categories:
 - C++
---

## 虚函数

### 定义和作用

虚函数是在基类中使用关键字`virtual`声明的成员函数，它允许**派生类**对其进行重写，实现运行时多态。当通过基类指针或引用调用虚函数时，实际调用的是对象类型对应的派生类中的函数，这个过程称为动态绑定或晚绑定

### 实现原理

虚函数的实现原理基于**虚函数表**。每个使用虚函数的类都有一个虚函数表，该表是一个函数指针数组，存储了指向类的虚函数的指针。类的每个实例都包含一个指向其虚函数表的指针，通过这个指针可以找到并调用正确的虚函数实现。

当派生类重写基类的虚函数时，派生类的虚函数表中相应位置的函数指针会被更新为指向派生类中的函数。如果派生类没有重写虚函数，则派生类的虚函数表中会保留指向基类虚函数的指针。

```cpp
#include <iostream>
using namespace std;

class Person {
    
public:
    virtual void test() {
        cout << "Person test" << endl;
    }
};

class Man : public Person {

public:
    void test() override {
        cout << "Man test" << endl;
    }
};

int main() {
    Person* p = new Man();
    p->test();

    Man m;
    Person& p1 = m;
    p1.test();
}
```

## 纯虚函数

纯虚函数是在基类中声明但不实现的虚函数，其声明方式是在函数声明的结尾处添加`=0`。类中如果包含至少一个虚函数，则该类成为抽象类，不能实例化对象

```cpp
#include <iostream>
using namespace std;

class Person {
    
public:
    virtual void test() = 0;
};

class Man : public Person {

public:
    void test() override {
        cout << "Man test" << endl;
    }
};

int main() {
    Person* p = new Man();
    p->test();

    Man m;
    Person& p1 = m;
    p1.test();
}
```