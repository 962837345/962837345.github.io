---
title: 引用
date: 2023-02-07
tags:
 - C++
categories:
 - C++
---


`数据类型 & 别名 = 原名`

* 引用必须初始化

* 引用在初始化后，不可以改变

### 引用作为函数参数

```cpp
// 值传递
void swap1(int a, int b)
{
    int temp = a;
    a = b;
    b = temp;
}

// 地址传递
void swap1(int *a, int *b)
{
    int temp = *a;
    *a = *b;
    *b = temp;
}

// 引用传递
void swap1(int &a, int &b)
{
    int temp = a;
    a = b;
    b = temp;
}
```

### 引用做函数的返回值

1. **不要返回局部变量的引用**

```cpp
int& test_func()
{
    int a = 10; // 局部变量存放在栈区
    return a;
}

int main()
{
    int &ref = test_func();
    cout << "ref = " << ref << endl; // 第一次结果正确，是因为编译器做了保留
    cout << "ref = " << ref << endl; // 第二次结果错误，是因为a的内存已经释放
}
```

2. **函数的调用可以作为左值**

```cpp
int& test_func()
{
    static int a = 10; // 静态变量，存放在全局区,全局区上的数据在程序结束后系统释放
    return a;
}

int main()
{
    int &ref = test_func();
    cout << "ref = " << ref << endl; 
    cout << "ref = " << ref << endl;
    
    test_func() = 1000; // 如果函数做左值，那么必须返回引用
    
    cout << "ref = " << ref << endl; 
    cout << "ref = " << ref << endl;
}
```

### 引用的本质

**引用的本质在c++内部实现是一个指针常量**

```cpp
void func(int& ref)
{
    ref = 100;
}

int main()
{
    int a = 10;
    
    // 自动转换为 int* const ref = &a; 指针常量是指针指向不可改，也说明为什么引用不可更改
    int& ref = a;
    ref = 20; // 内部发现ref是引用，自动帮我们转换为: * ref = 20;
    
    cout << "a:" << a << endl;
    cout << "ref:" << ref << endl;
    
    func(a);
    return 0;
}
```

### 常量引用

**作用**：常量引用主要用来修饰形参，防止误操作

在函数形参列表中，可以加**const修饰形参**，防止形参改变实参

```cpp
int main()
{
    // 加上const后， 编译器将代码修改 int temp = 10; const int & ref = temp;
    const int & ref = 10; // 引用必须引一块合法的内存空间
}
```

