---
title: 折叠面板的实现与封装
date: 2020-07-30
tags:
 - JS
categories:
 - 前端笔记
---

<ClientOnly>
  <collapse-view style="margin-bottom: 50px"/>
</ClientOnly>


## 参数说明

### collapse参数
* accordion：实现手风琴效果
### collapse-item参数
* title：折叠面板的标题
* index：折叠面板的索引，按顺序传递，以0开始

## CollapseView
```vue
<template>
  <collapse accordion>
    <collapse-item title="点一下试试" index="0">
      <div>我被粗鲁地打开了</div>
      <div>赶紧把我给关掉</div>
    </collapse-item>
    <collapse-item title="试试就试试" index="1">
      <div>不试试上面的吗？</div>
    </collapse-item>
    <collapse-item title="打开有宝藏" index="2">
      <div>这里什么也没有</div>
    </collapse-item>
  </collapse>
</template>

<script>
  import Collapse from "./Collapse";
  import CollapseItem from "./CollapseItem";
  export default {
    name: "CollapseView",
    components: {CollapseItem, Collapse}
  }
</script>

<style scoped>

</style>
```

## Collapse
```vue
<template>
  <div class="collapse">
    <slot></slot>
  </div>
</template>

<script>
  export default {
    name: "Collapse",
    props: {
      accordion: {
        type: Boolean,
        default: false
      }
    }
  }
</script>

<style scoped>
  * {
    margin: 0;
    padding: 0;
  }

  .collapse {
    background-color: white;
    padding: 0 10px;
    border-radius: 5px;
    border: 1px solid #DCDFE6;
    margin: 10px;
    width: 500px;
  }

</style>
```

## CollapseItem
```vue
<template>
  <div class="collapse-item" @click="openAndClose(index)">
    <span>{{title}}</span>
    <span class="direction">></span>
    <div class="content">
      <slot></slot>
    </div>
  </div>
</template>

<script>
  export default {
    name: "CollapseItem",
    props: {
      title: {
        type: String,
        default: ""
      },
      index: {
        type: String,
        default: 0
      },
    },
    data() {
      return {
        el: {},
        arrow: {},
        accordion:false
      }
    },
    mounted() {
      this.accordion = this.$parent.accordion;
      this.el = document.getElementsByClassName("content");
      this.arrow = document.getElementsByClassName("direction")
    },
    methods: {
      openAndClose(index) {
        let el = this.el[index];
        let arrow = this.arrow[index];
        if (window.getComputedStyle(el).height === "0px") {
          // mac Safari下，貌似auto也会触发transition, 故要none下~
          el.style.transition = "none";
          // 设置高度为auto
          el.style.height = "auto";
          //  设置外边距为0
          el.style.margin = "0";
          //  获取当前的height
          let targetHeight = window.getComputedStyle(el).height;
          //  设置渐变
          el.style.transition = "all 600ms";
          //  重新将height设置为0
          el.style.height = "0px";
          //  设置箭头的渐变
          arrow.style.transition = "all 600ms";

          //触发浏览器重排（关键）
          el.offsetWidth;

          arrow.style.transform = "rotate(90deg)";
          el.style.height = targetHeight;
          el.style.margin = "20px 0";
          this.closeOther();
        } else {
          el.style.height = "0px";
          el.style.margin = "0";
          arrow.style.transform = "rotate(0deg)";
        }
      },
      closeOther() {
        if(!this.accordion)return;
        for (let i = 0; i < this.el.length; i++) {
          if (i.toString() !== this.index) {
            if (window.getComputedStyle(this.el[i]).height !== "0px") {
              this.el[i].style.height = "0px";
              this.el[i].style.margin = "0";
              this.arrow[i].style.transform = "rotate(0deg)";
            }
          }
        }
      }
    }
  }
</script>

<style scoped>
  .collapse-item {
    border-bottom: 1px solid #DCDFE6;
    padding: 20px 0;
    cursor: pointer;
  }

  .collapse-item .direction {
    float: right;
  }

  .collapse-item .content {
    height: 0;
    overflow: hidden;
  }
</style>
```