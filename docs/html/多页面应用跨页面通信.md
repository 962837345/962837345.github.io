---
title: 多页面应用跨页面通信
date: 2020-09-07
tags:
 - HTML
categories:
 - 前端笔记
---

## localStorage
通过`localStorage.setItem('键名','键值')`设置localStorage

通过`localStorage.getItem('键名')`获取对应存储的storage

也可以这样设置localStorage:
```js
const storage = localStorage;
storage.a = 'hello';
storage['b'] = 'world'
```

localStorage中有监听storage变化的事件
```js
window.addEventListener('storage',function(e) {
  console.log(e)
})
```
这里会监听storage的改变，function中传过来的e是一个storageEvent，其中有对应改变的storage的key和oldValue跟newValue，通过这个去获取新的value

localStorage通过`localStorage.removeItem('键名')`来删除一个数据

localStorage的一些局限
1. IE8以上的IE版本才支持localStorage
2. 目前所有的浏览器中都会把localStorage的值类型限定为string类型，这个在对我们日常比较常见的JSON对象类型需要一些转换
3. localStorage在浏览器的隐私模式下面是不可读取的
4. localStorage本质上是对字符串的读取，如果存储内容多的话会消耗内存空间，会导致页面变卡
5. localStorage不能被爬虫抓取到

:::tip
* 当我们将一个JSON数据存入localStorage中时，localStorage会将JSON自动转换为字符串，这时我们可以使用`JSON.stringify()`把JSON转成JSON字符串:`localStorage.setItem('key','JSON.stringify(data)')` 
* 取出localStorage中的JSON字符串数据时使用JSON.parse()方法转换回来:`JSON.parse(localStorage.getItem('key')); `
:::

## BroadcastChannel
每个页面通过创建一个具有相同频道名称的 `BroadcastChannel` 对象来加入特定频道。 然后实现 `onmessage` 
接口来监听消息事件。通过调用 `BroadcastChannel` 对象上的 `postMessage()` 方法可以在频道中广播一条消息
给所有订阅者。调用close()可以关闭连接

页面1中
```js
const bc = new BroadcastChannel('home');
bc.postMessage('hello world')
```

页面2中
```js
const bc = new BroadcastChannel('home');
bc.onmessage = function(e){
    console.log(e.data)
}
```

:::warning
兼容性问题，IE、Safari不支持
:::