---
title: 前端安全
date: 2020-11-26
tags:
 - HTML
categories:
 - 前端笔记
---

## XSS

XSS，即Cross Site Script(跨站脚本攻击)。XSS攻击是指攻击者在网上注入恶意的客户端代码，通过恶意脚本对客户端网页进行篡改，从而在用户浏览网页时，对用户浏览器进行控制或获取用户隐私数据的一种攻击方式

攻击者对客户端网页注入的恶意脚本一般包括Javascript，有时也会包含HTML和Flash。有很多种方式进行XSS攻击，但它们的共同点为：将一些隐私数据像cookie、session发送给攻击者，将受害者重定向到一个由攻击者控制的网站，在受害者的机器上进行一些恶意操作

XSS攻击可以分为3类：反射型（非持久型）、存储型（持久型）、基于DOM

1. 反射型

发出请求时，XSS代码出现在url种，作为输入提交到服务器端，服务器端解析后响应，XSS代码随响应内容一起传回浏览器，最后浏览器解析执行XSS代码。这个过程像一次反射，所以叫反射型XSS

2. 存储型

存储型XSS和反射型的差别在于，提交的代码会存储在服务器端（数据库、内存、文件系统等），下次请求目标页面时不用再提交XSS代码

3. 基于DOM

基于DOM的XSS攻击是指通过恶意脚本修改页面的DOM结构，是存粹发生在客户端的攻击

### 防范措施

1. HttpOnly防止截取Cookie

攻击者可以通过注入恶意脚本获取用户的Cookie信息。通常Cookie中都包含了用户的登录凭证信息，攻击者在获取到Cookie之后，则可以发起Cookie劫持攻击。所以，严格来说，HttpOnly并非阻止XSS攻击，而是能阻止XSS攻击后的Cookie劫持攻击

2. 输入检查

不要相信用户的任何输入。对用户的任何输入都要进行检查、过滤和转义

在XSS防御中，输入检查一般是检查用户的数据中是否包含`<`、`>`等特殊字符，如果存在，则对特殊字符进行过滤或编码，这种方式也称XSS Filter

## CSRF

CSRF，即 Cross Site Request Forgery （跨站请求伪造），是一种劫持受信任用户向服务器发送非预期请求的攻击方式

通常情况下，CSRF攻击是攻击者借助受害者的Cookie骗取服务器的信任，可以在受害者毫不知情的情况下以受害者名义伪造请求发送给受攻击的服务器，从而在未授权的情况下执行在权限保护下的操作

<img style="height: 300px" :src="$withBase('/CSRF.jpg')" alt="CSRF原理">

从上图可以看出，要完成一次CSRF攻击，受害者必须满足两个必要的条件：

1. 登录受信任的网站A，并在本地生成Cookie（如果用户没有登录网站A，那么网站B在诱导的时候，请求网站A的api接口时，会提示你登录）
2. 在不登出A的情况下，访问危险网站B

:::tip

cookie保证了用户可以处于登录状态，但网站B其实拿不到cookie

:::

### 防御措施

1. Token验证
   * 服务器发送给客户端一个token
   * 客户端提交的表单中带着这个token
   * 如果这个token不合法，那么服务器拒绝这个请求

2. 隐藏令牌

把token隐藏在http的head头中

3. Referer验证

Referer指的时页面请求来源。意思是，只接受本站的请求，服务器才做响应；如果不是，就拦截

4. 验证码

CSRF攻击往往是在用户不知情的情况下构造了网络请求。而验证码会强制用户必须与应用进行交互，才能完成最终请求。因此通常情况下，验证码能够很好地遏制CSRF攻击

但是验证码不是万能的，处于交互性的考虑，不能给网站所以操作都加上验证码。因此，验证码只能作为防御CSRF的一种辅助手段，而不能作为最主要的解决方案

## 中间人攻击

中间人攻击是攻击方同时与服务器和客户端建立连接，并让对方认为连接是安全的，但是实际上整个通信过程都被攻击者控制了。攻击者不仅能够获得双方的通信信息，还能修改通信信息。

<img style="height: 500px" :src="$withBase('/middle_attack.jfif')" alt="中间人攻击">

### 防御措施

HTTPS单向验证。在客户端中内置服务器公钥，在第三步服务器返回的公钥，除了验证公钥的有效性之外，再比对公钥是不是和内置的公钥一样，不一样说明被中间人攻击了，就断开链接不再请求。

## 点击劫持

点击劫持是一种视觉欺骗的攻击手段。攻击者将需要攻击的网站通过iframe嵌套的方式嵌入自己的网页中，并将iframe设置为透明，在页面中透出一个按钮诱导用户点击。

### 防御措施

1. X-FRAME-OPTIONS

   X-FRAME-OPTIONS是一个HTTP响应头，在现在浏览器有一个很好的支持。这个HTTP响应头就是为了防御用iframe嵌套点击劫持攻击

   该响应头有三个可选，分别是：

   * DENY，表示页面不允许通过iframe的方式展示
   * SMAEORIGIN，表示页面可以在相同域名虾通过iframe的方式展示
   * ALLOW-FORM，表示页面可以在指定来源的iframe中展示

2. JS防御

   对于某些比较老的浏览器并不支持上面的这种方式，只能通过JS的方式来防御点击劫持。

## SQL注入

SQL注入是通过SQL语句，实现无账号登录，甚至篡改数据库

### 防御措施

1. PreparedStatement
2. 使用正则表达式过滤传入的参数
3. 字符串过滤